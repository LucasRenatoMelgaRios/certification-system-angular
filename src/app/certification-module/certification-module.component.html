<div class="cert-module">
  <div class="cert-header">
    <h2>PLANTILLAS DE CERTIFICADOS GUARDADOS</h2>
    <div class="cert-selection">
      <div 
        *ngFor="let cert of certTemplates" 
        class="cert-template" 
        [class.active]="selectedCert?.id === cert.id" 
        (click)="selectTemplate(cert)"
      >
        <div class="cert-template-preview">
          <img [src]="cert.imageUrl" [alt]="cert.name" />
        </div>
        <span>{{ cert.name }}</span>
      </div>
    </div>
  </div>

  <div class="cert-content">
    <div class="left-panel">
      <div class="drop-zones-control">
        <h4>Zonas de colocación</h4>
        <div class="drop-zones-list">
          <div *ngFor="let zone of currentPageState.dropZones" class="drop-zone-item">
            <span>{{ zone.label }}</span>
            <div class="drop-zone-actions">
              <button (click)="handleSelectElement('dropZone', zone.id)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path d="M3 3h18v18H3z"></path>
                </svg>
              </button>
              <button (click)="toggleZoneVisibility(zone.id)" [title]="zone.hidden ? 'Mostrar elemento' : 'Ocultar elemento'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                  <path *ngIf="!zone.hidden" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle *ngIf="!zone.hidden" cx="12" cy="12" r="3"></circle>
                  <path *ngIf="zone.hidden" d="M17.94 17.94A10 10 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5-5"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
        
        <div class="drag-instructions">
          <p>Haz clic en una zona y usa las flechas del teclado para moverla</p>
          <p>Mantén presionado Shift + flechas para movimientos más grandes</p>
          <p>Usa el icono de ojo para ocultar/mostrar elementos</p>
        </div>
      </div>
    </div>

    <div class="certificate-preview" #certificateContainerRef>
      <div class="zoom-controls-container">
        <button class="zoom-button" (click)="handleZoomOut()" [disabled]="zoomLevel <= 0.5">
          -
        </button>
        <span class="zoom-level-display">{{ (zoomLevel * 100).toFixed(0) }}%</span>
        <button class="zoom-button" (click)="handleZoomIn()" [disabled]="zoomLevel >= 2">
          +
        </button>
      </div>

      <h3>{{ getCurrentTemplate()?.pageType === 'front' ? 'CERTIFICADO' : 'DIPLOMADO' }}</h3>
      <div *ngIf="getTemplateForPage('back')" class="template-view-controls">
        <button 
          (click)="showFrontTemplate()"
          [class.active]="currentPageId === 'front'"
        >
          Vista Frontal
        </button>
        <button 
          (click)="showBackTemplate()"
          [class.active]="currentPageId === 'back'"
        >
          Vista Trasera
        </button>
      </div>
      
      <div 
        class="certificate-content" 
        [style.transform]="'scale(' + zoomLevel + ')'"
        [style.transform-origin]="'0 0'"
        [style.width.px]="certSize.width"
        [style.height.px]="certSize.height"
      >
        <div 
          class="certificate-background" 
          #certificateRef
          [style.backgroundImage]="'url(' + (getCurrentTemplate()?.imageUrl || '') + ')'"
          [style.width.px]="certSize.width"
          [style.height.px]="certSize.height"
        ></div>
        
        <div 
          *ngFor="let zone of currentPageState.dropZones" 
          class="drop-zone"
          [class.selected]="currentPageState.selectedElement?.type === 'dropZone' && currentPageState.selectedElement?.id === zone.id"
          [class.hidden]="zone.hidden"
          [style.left.px]="zone.position.x"
          [style.top.px]="zone.position.y"
          (mousedown)="startDraggingZone($event, zone)"
          (click)="handleSelectElement('dropZone', zone.id)"
        >
          <span class="zone-content">
            {{ getStudentDataForZone(zone.label) }}
          </span>
          
          <div class="drop-zone-controls">
            <button class="control-button toggle-visibility" 
                    (click)="$event.stopPropagation(); toggleZoneVisibility(zone.id)"
                    [title]="zone.hidden ? 'Mostrar elemento' : 'Ocultar elemento'">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path *ngIf="!zone.hidden" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle *ngIf="!zone.hidden" cx="12" cy="12" r="3"></circle>
                <path *ngIf="zone.hidden" d="M17.94 17.94A10 10 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5-5"></path>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="cert-footer">
    <button 
      class="export-button" 
      (click)="handleExportPDF()"
    >
      Exportar {{ getCurrentTemplate()?.pageType === 'front' ? 'Certificado' : 'Diplomado' }} PDF
    </button>
  </div>
</div>