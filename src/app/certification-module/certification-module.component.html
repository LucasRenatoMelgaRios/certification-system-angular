<div class="cert-module">
  <div class="cert-header">
    <h2>PLANTILLAS DE CERTIFICADOS</h2>
    <div class="cert-selection">
      <div *ngFor="let cert of certTemplates" 
           class="cert-template" 
           [class.active]="selectedCert?.id === cert.id" 
           (click)="selectTemplate(cert)">
        <div class="cert-template-preview">
          <img [src]="cert.imageUrl" [alt]="cert.name">
        </div>
        <span>{{ cert.name }}</span>
      </div>
    </div>
  </div>
  <div class="cert-content">
    <div class="left-panel">
      <div class="controls-section">
        <div class="certificate-type-selector">
          <h3>Tipo de Documento</h3>
          <div class="type-options">
            <button [class.active]="certificateType === 'curso'" 
                    (click)="changeCertificateType('curso')">
              Certificado
            </button>
            <button [class.active]="certificateType === 'diplomado'" 
                    (click)="changeCertificateType('diplomado')">
              Diplomado
            </button>
            <button [class.active]="certificateType === 'constancia'" 
                    (click)="changeCertificateType('constancia')">
              Constancia
            </button>
          </div>
        </div>

        <div class="signature-controls" *ngIf="certificateType !== 'constancia'">
          <h3>Tipo de Plantilla</h3>
          <div class="signature-options">
            <button [class.active]="!currentTemplateHasSignature"
                    (click)="toggleSignature(false)">
              Sin Firma
            </button>
            <button [class.active]="currentTemplateHasSignature"
                    (click)="toggleSignature(true)">
              Con Firma
            </button>
          </div>
        </div>

        <div class="view-controls" *ngIf="certificateType !== 'constancia'">
          <button (click)="showFrontTemplate()"
                  [class.active]="currentPageId === 'front'">
            Vista Frontal
          </button>
          <button *ngIf="getTemplateForPage('back')"
                  (click)="showBackTemplate()"
                  [class.active]="currentPageId === 'back'">
            Vista Trasera
          </button>
        </div>

        <button class="export-button" (click)="handleExportPDF()">
          <i class="icon-download"></i> Exportar PDF
        </button>

        <div class="zoom-controls">
          <button class="zoom-button" (click)="handleZoomOut()" [disabled]="zoomLevel <= 0.5">
            <i class="icon-zoom-out"></i>
          </button>
          <span>{{ (zoomLevel * 100).toFixed(0) }}%</span>
          <button class="zoom-button" (click)="handleZoomIn()" [disabled]="zoomLevel >= 2">
            <i class="icon-zoom-in"></i>
          </button>
        </div>
      </div>

      <div class="fields-list">
        <h3>Campos Disponibles</h3>
        <div *ngFor="let zone of currentPageState.dropZones" 
             class="field-item"
             [class.hidden]="zone.hidden"
             [class.selected]="currentPageState.selectedElement?.id === zone.id"
             (click)="handleSelectElement('dropZone', zone.id)">
          <span>{{ getFieldLabel(zone.fieldKey) }}</span>
          <button (click)="toggleZoneVisibility(zone.id); $event.stopPropagation()"
                  [title]="zone.hidden ? 'Mostrar campo' : 'Ocultar campo'">
            <i [class]="zone.hidden ? 'icon-eye-closed' : 'icon-eye'"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="certificate-preview" #certificateContainerRef>
      <div class="certificate-container">
        <div class="certificate-content" 
             [style.transform]="'scale(' + zoomLevel + ')'"
             [style.width.px]="certSize.width"
             [style.height.px]="certSize.height">
          
          <div class="certificate-background" 
               #certificateRef
               [style.backgroundImage]="'url(' + (getCurrentTemplate()?.imageUrl || '') + ')'">
          </div>
          
          <div *ngFor="let zone of currentPageState.dropZones"
               class="drop-zone"
               [class.selected]="currentPageState.selectedElement?.id === zone.id"
               [class.hidden]="zone.hidden"
               [style.left.px]="zone.position.x"
               [style.top.px]="zone.position.y"
               (mousedown)="startDraggingZone($event, zone)"
               (click)="handleSelectElement('dropZone', zone.id)">
            
            <div class="zone-content">
              <ng-container *ngIf="zone.type === 'dates'; else textField">
                <div *ngFor="let line of getStudentDataForZone(zone.fieldKey).split('\n')">
                  {{ line }}
                </div>
              </ng-container>
              
              <ng-template #textField>
                {{ getStudentDataForZone(zone.fieldKey) }}
              </ng-template>
            </div>

            <div class="drop-zone-controls">
              <button (click)="toggleZoneVisibility(zone.id); $event.stopPropagation()"
                      class="visibility-toggle"
                      [title]="zone.hidden ? 'Mostrar campo' : 'Ocultar campo'">
                <i [class]="zone.hidden ? 'icon-eye-closed' : 'icon-eye'"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>